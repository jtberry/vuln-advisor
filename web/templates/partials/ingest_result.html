{#
  partials/ingest_result.html -- HTMX fragment: ingest operation result.

  Swapped into #ingest-result on the /ingest page.

  Required context variables:
    assets_created  -- int
    vulns_assigned  -- int
    vulns_skipped   -- int
    errors          -- list[str]
    new_assets      -- list[dict] with keys: id, hostname
#}

{% if errors and not vulns_assigned and not assets_created %}

{# Pure failure -- nothing was processed #}
<div class="alert py-3 px-3 mt-2"
     style="background-color: rgba(218,54,51,0.1); border-color: #da3633; font-size: 0.82rem">
  <div class="fw-semibold mb-2" style="color: #f85149">Ingest failed</div>
  <ul class="mb-0 ps-3" style="color: #c9d1d9">
    {% for err in errors %}
    <li>{{ err }}</li>
    {% endfor %}
  </ul>
</div>

{% else %}

{# Success -- at least some records were processed #}
<div class="card mt-2" style="border-color: #238636">
  <div class="card-body p-3" style="font-size: 0.82rem">

    <div class="fw-semibold mb-3" style="color: #3fb950">Ingest complete</div>

    <div class="d-flex gap-4 mb-3">
      <div>
        <div class="fw-bold" style="font-size: 1.1rem; color: #3fb950">{{ assets_created }}</div>
        <div class="text-muted" style="font-size: 0.72rem">assets created</div>
      </div>
      <div>
        <div class="fw-bold" style="font-size: 1.1rem; color: #388bfd">{{ vulns_assigned }}</div>
        <div class="text-muted" style="font-size: 0.72rem">CVEs assigned</div>
      </div>
      <div>
        <div class="fw-bold" style="font-size: 1.1rem; color: #8b949e">{{ vulns_skipped }}</div>
        <div class="text-muted" style="font-size: 0.72rem">duplicates skipped</div>
      </div>
    </div>

    {% if new_assets %}
    <div class="mb-3">
      <div class="text-muted mb-1" style="font-size: 0.78rem; font-weight: 600">New assets:</div>
      <ul class="mb-0 ps-3">
        {% for a in new_assets %}
        <li>
          <a href="/assets/{{ a.id }}" class="font-mono" style="font-size: 0.8rem">
            {{ a.hostname }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {% if errors %}
    <div>
      <div class="text-muted mb-1" style="font-size: 0.78rem; font-weight: 600">Warnings:</div>
      <ul class="mb-0 ps-3" style="color: #8b949e">
        {% for err in errors %}
        <li style="font-size: 0.78rem">{{ err }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

  </div>
</div>

{% endif %}
